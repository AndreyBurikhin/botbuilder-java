package com.microsoft.bot.connector;

import com.microsoft.bot.connector.customizations.BotAuthenticator;
import com.microsoft.bot.connector.customizations.BotCredentials;
import com.sun.net.httpserver.Headers;
import org.junit.Assert;
import org.junit.Test;

public class BotAuthenticatorTest {

    @Test
    public void AuthHeaderWithCorrectAppIdAndServiceUrl() {
        BotCredentials credentials = new BotCredentials()
                .withAppId("39619a59-5a0c-4f9b-87c5-816c648ff357")
                .withAppPassword("");
        BotAuthenticator authenticator = new BotAuthenticator(credentials, false);
        Headers headers = new Headers();
        headers.add("authorization", "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6IkdDeEFyWG9OOFNxbzdQd2VBNy16NjVkZW5KUSIsIng1dCI6IkdDeEFyWG9OOFNxbzdQd2VBNy16NjVkZW5KUSJ9.eyJzZXJ2aWNldXJsIjoiaHR0cHM6Ly93ZWJjaGF0LmJvdGZyYW1ld29yay5jb20vIiwiaXNzIjoiaHR0cHM6Ly9hcGkuYm90ZnJhbWV3b3JrLmNvbSIsImF1ZCI6IjM5NjE5YTU5LTVhMGMtNGY5Yi04N2M1LTgxNmM2NDhmZjM1NyIsImV4cCI6MTUxNjczNzUyMCwibmJmIjoxNTE2NzM2OTIwfQ.TBgpxbDS-gx1wm7ldvl7To-igfskccNhp-rU1mxUMtGaDjnsU--usH4OXZfzRsZqMlnXWXug_Hgd_qOr5RH8wVlnXnMWewoZTSGZrfp8GOd7jHF13Gz3F1GCl8akc3jeK0Ppc8R_uInpuUKa0SopY0lwpDclCmvDlz4PN6yahHkt_666k-9UGmRt0DDkxuYjbuYG8EDZxyyAhr7J6sFh3yE2UGRpJjRDB4wXWqv08Cp0Gn9PAW2NxOyN8irFzZH5_YZqE3DXDAYZ_IOLpygXQR0O-bFIhLDVxSz6uCeTBRjh8GU7XJ_yNiRDoaby7Rd2IfRrSnvMkBRsB8MsWN8oXg");

        boolean result = authenticator.authenticate(headers, "webchat", "https://webchat.botframework.com/");
        Assert.assertTrue(result);
    }

    @Test
    public void AuthHeaderWithWrongAppIdAndServiceUrl() {
        BotCredentials credentials = new BotCredentials()
                .withAppId("00000000-0000-0000-0000-000000000000")
                .withAppPassword("");
        BotAuthenticator authenticator = new BotAuthenticator(credentials, false);
        Headers headers = new Headers();
        headers.add("authorization", "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6IkdDeEFyWG9OOFNxbzdQd2VBNy16NjVkZW5KUSIsIng1dCI6IkdDeEFyWG9OOFNxbzdQd2VBNy16NjVkZW5KUSJ9.eyJzZXJ2aWNldXJsIjoiaHR0cHM6Ly93ZWJjaGF0LmJvdGZyYW1ld29yay5jb20vIiwiaXNzIjoiaHR0cHM6Ly9hcGkuYm90ZnJhbWV3b3JrLmNvbSIsImF1ZCI6IjM5NjE5YTU5LTVhMGMtNGY5Yi04N2M1LTgxNmM2NDhmZjM1NyIsImV4cCI6MTUxNjczNzUyMCwibmJmIjoxNTE2NzM2OTIwfQ.TBgpxbDS-gx1wm7ldvl7To-igfskccNhp-rU1mxUMtGaDjnsU--usH4OXZfzRsZqMlnXWXug_Hgd_qOr5RH8wVlnXnMWewoZTSGZrfp8GOd7jHF13Gz3F1GCl8akc3jeK0Ppc8R_uInpuUKa0SopY0lwpDclCmvDlz4PN6yahHkt_666k-9UGmRt0DDkxuYjbuYG8EDZxyyAhr7J6sFh3yE2UGRpJjRDB4wXWqv08Cp0Gn9PAW2NxOyN8irFzZH5_YZqE3DXDAYZ_IOLpygXQR0O-bFIhLDVxSz6uCeTBRjh8GU7XJ_yNiRDoaby7Rd2IfRrSnvMkBRsB8MsWN8oXg");

        boolean result = authenticator.authenticate(headers, "webchat", "https://webchat.botframework.com/");
        Assert.assertFalse(result);
    }

    @Test
    public void AuthHeaderWithAppIdAndWrongServiceUrl() {
        BotCredentials credentials = new BotCredentials()
                .withAppId("39619a59-5a0c-4f9b-87c5-816c648ff357")
                .withAppPassword("");
        BotAuthenticator authenticator = new BotAuthenticator(credentials, false);
        Headers headers = new Headers();
        headers.add("authorization", "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6IkdDeEFyWG9OOFNxbzdQd2VBNy16NjVkZW5KUSIsIng1dCI6IkdDeEFyWG9OOFNxbzdQd2VBNy16NjVkZW5KUSJ9.eyJzZXJ2aWNldXJsIjoiaHR0cHM6Ly93ZWJjaGF0LmJvdGZyYW1ld29yay5jb20vIiwiaXNzIjoiaHR0cHM6Ly9hcGkuYm90ZnJhbWV3b3JrLmNvbSIsImF1ZCI6IjM5NjE5YTU5LTVhMGMtNGY5Yi04N2M1LTgxNmM2NDhmZjM1NyIsImV4cCI6MTUxNjczNzUyMCwibmJmIjoxNTE2NzM2OTIwfQ.TBgpxbDS-gx1wm7ldvl7To-igfskccNhp-rU1mxUMtGaDjnsU--usH4OXZfzRsZqMlnXWXug_Hgd_qOr5RH8wVlnXnMWewoZTSGZrfp8GOd7jHF13Gz3F1GCl8akc3jeK0Ppc8R_uInpuUKa0SopY0lwpDclCmvDlz4PN6yahHkt_666k-9UGmRt0DDkxuYjbuYG8EDZxyyAhr7J6sFh3yE2UGRpJjRDB4wXWqv08Cp0Gn9PAW2NxOyN8irFzZH5_YZqE3DXDAYZ_IOLpygXQR0O-bFIhLDVxSz6uCeTBRjh8GU7XJ_yNiRDoaby7Rd2IfRrSnvMkBRsB8MsWN8oXg");

        boolean result = authenticator.authenticate(headers, "webchat", "https://skype.botframework.com/");
        Assert.assertFalse(result);
    }

    @Test
    public void AuthHeaderEmulatorWithoutAppIdAndServiceUrl() {
        BotCredentials credentials = new BotCredentials()
                .withAppId("")
                .withAppPassword("");
        BotAuthenticator authenticator = new BotAuthenticator(credentials, false);
        Headers headers = new Headers();

        boolean result = authenticator.authenticate(headers, "emulator", "");
        Assert.assertTrue(result);
    }

    @Test
    public void AuthHeaderNotEmulatorWithoutAppIdAndServiceUrl() {
        BotCredentials credentials = new BotCredentials()
                .withAppId("")
                .withAppPassword("");
        BotAuthenticator authenticator = new BotAuthenticator(credentials, false);
        Headers headers = new Headers();

        boolean result = authenticator.authenticate(headers, "webchat", "");
        Assert.assertFalse(result);
    }
}
